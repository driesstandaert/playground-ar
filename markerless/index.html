<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Bievre - markerless</title>
    <meta name="description" content="glTF Model - A-Frame">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="scripts.js"></script>
    <!-- <script src="shaders/water.js"></script> -->
    <script>

      // Requires a build from the latest a-frame master (August 2016, v0.3)

AFRAME.registerComponent('wobble-normal', {
	schema: {},
	tick: function (t) {
		if (!this.el.components.material.material.normalMap) return;
		this.el.components.material.material.normalMap.offset.x += 0.0001 * Math.sin(t/10000);
		this.el.components.material.material.normalMap.offset.y += 0.0001 * Math.cos(t/8000);
		this.el.components.material.material.normalScale.x = 0.5 + 0.5 * Math.cos(t/1000);
		this.el.components.material.material.normalScale.x = 0.5 + 0.5 * Math.sin(t/1200);
	}
})

AFRAME.registerPrimitive('a-ocean-plane', {
	defaultComponents: {
		geometry: {
			primitive: 'plane',
			height: 10000,
			width: 10000
		},
		rotation: '-90 0 0',
		material: {
			shader: 'standard',
			color: '#8ab39f',
			metalness: 1,
			roughness: 0.2,
			normalMap: 'url(https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/waternormals.jpg)',
			normalTextureRepeat: '50 50',
			normalTextureOffset: '0 0',
			normalScale: '0.5 0.5',
			opacity: 0.8
		},
		'wobble-normal': {}
	},
});


    </script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true">
      <a-assets>
        <a-asset-item id="bievre" src="../assets/animals/bievre2/scene.gltf"></a-asset-item>
        <img
          id="water-normal"
          src="./textures/waternormals.jpg"
          crossorigin="anonymous"
        />
        <img
          id="skysphere"
          src="./textures/tears_of_steel_bridge_2k.jpg"
          crossorigin="anonymous"
        />
      </a-assets>
      <!-- <a-entity id="sky" geometry="primitive: sphere; radius: 100" material="shader: sky; side: back" sun-position-setter hide-in-ar-mode>
        <a-entity id="orbit" animation="property: rotation; to: 0 360 0; dur: 5000; loop: true; easing: linear"></a-entity>
      </a-entity> -->
      <a-sky src="#skysphere" position="0 -1 0" rotation="0 0 0"></a-sky>

      <a-ocean-plane
        material="normalMap: #water-normal; sphericalEnvMap: #skysphere;"
      ></a-ocean-plane>
      <a-entity gltf-model="#bievre" scale="16 16 16" position="0 0 -2" play-all-model-animations ></a-entity>
    </a-scene>
  </body>
</html>